name: 01 - Hello Runner Enhanced

on:
  workflow_dispatch:

jobs:
  hello:
    runs-on: self-hosted

    # expose secrets via env for use in expressions safely
    env:
      SMTP_USER: ${{ secrets.SMTP_USER || '' }}
      SMTP_PASS: ${{ secrets.SMTP_PASS || '' }}

    steps:
      - name: Display system information
        run: |
          echo "==============================="
          echo " Hello from your self-hosted runner!"
          echo "==============================="
          echo "User     : $USER"
          echo "Hostname : $(hostname)"
          echo "Kernel   : $(uname -a)"
          echo "Date     : $(date)"
          echo "==============================="

      - name: Save output to file
        run: |
          mkdir -p out
          {
            echo "Hello Runner Report"
            echo "==================="
            echo "User: $USER"
            echo "Host: $(hostname)"
            echo "Kernel: $(uname -a)"
            echo "Date: $(date)"
          } > out/report.txt

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: hello-runner-report
          path: out/report.txt

      - name: Print confirmation
        run: |
          echo "✅ Workflow complete!"
          echo "Artifact 'hello-runner-report' uploaded."

      # --- OPTIONAL EMAIL (only if creds exist) ---
      - name: Send email notification (optional)
        if: ${{ success() && env.SMTP_USER != '' && env.SMTP_PASS != '' }}
        continue-on-error: true
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ env.SMTP_USER }}
          password: ${{ env.SMTP_PASS }}
          from: ${{ env.SMTP_USER }}
          to: "jcj0hns0n76@hotmail.com"
          subject: "Hello Runner Completed ✅"
          body: |
            The Hello Runner workflow has finished successfully!
            Artifact: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

      - name: No email configured notice
        if: ${{ env.SMTP_USER == '' || env.SMTP_PASS == '' }}
        run: echo "ℹ️ Email notification skipped — SMTP credentials not configured."
