name: 01 - Hello Runner Enhanced
on:
  workflow_dispatch:

jobs:
  hello:
    runs-on: self-hosted
    steps:
      - name: Display system information
        run: |
          echo "==============================="
          echo " Hello from your self-hosted runner!"
          echo "==============================="
          echo "User     : $USER"
          echo "Hostname : $(hostname)"
          echo "Kernel   : $(uname -a)"
          echo "Date     : $(date)"
          echo "==============================="

      - name: Save output to file
        run: |
          mkdir -p out
          {
            echo "Hello Runner Report"
            echo "==================="
            echo "User: $USER"
            echo "Host: $(hostname)"
            echo "Kernel: $(uname -a)"
            echo "Date: $(date)"
          } > out/report.txt

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: hello-runner-report
          path: out/report.txt

      - name: Print confirmation
        run: |
          echo "✅ Workflow complete!"
          echo "Artifact 'hello-runner-report' uploaded."

      # Optional email step (won’t break build if it fails)
      - name: Send email notification (optional)
        if: ${{ success() && secrets.SMTP_USER != '' && secrets.SMTP_PASS != '' }}
        continue-on-error: true
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 465
          secure: true
          username: ${{ secrets.SMTP_USER }}
          password: ${{ secrets.SMTP_PASS }}
          from: ${{ secrets.SMTP_USER }}
          to: "James.Johnson@csa-architeks.com"
          subject: "Hello Runner Completed ✅"
          body: |
            The Hello Runner workflow has finished successfully!
            You can download the artifact here:
            https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}

      # If SMTP secrets are not configured, still show confirmation
      - name: No email configured notice
        if: ${{ secrets.SMTP_USER == '' || secrets.SMTP_PASS == '' }}
        run: |
          echo "ℹ️ Email notification skipped — SMTP credentials not configured."
