name: Build & Smoke Test (Docker)

on:
  workflow_dispatch: {}   # run manually for now

jobs:
  build:
    runs-on: [self-hosted, ubuntu, lab]   # matches your runner labels
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Show files (debug)
        run: |
          pwd
          ls -la
          docker version
          docker info || true

      - name: Build image
        run: docker build -t ci-sbx:latest .

      - name: Run container
        run: |
          docker rm -f ci-sbx || true
          docker run -d --name ci-sbx -p 8088:80 ci-sbx:latest
          sleep 3
          curl -sSf http://localhost:8088 | head -n 5

      - name: Clean up
        if: always()
        run: |
          docker logs ci-sbx || true
          docker rm -f ci-sbx || true
          docker image rm ci-sbx:latest || true
